C251 COMPILER V5.60.0,  main1                                                              24/07/23  20:15:48  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main1
OBJECT MODULE PLACED IN .\main1.obj
COMPILER INVOKED BY: D:\keil\C251\BIN\C251.EXE ..\src\main1.c XSMALL INTR2 BROWSE INCDIR(..\inc) DEBUG PRINT(.\main1.lst
                    -) TABS(2) OBJECT(.\main1.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- STC MCU Limited ------------------------------------------------*/
    3          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
    4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
    5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
    6          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
    7          /* --- Web: www.STCMCU.com --------------------------------------------*/
    8          /* --- Web: www.STCMCUDATA.com  ---------------------------------------*/
    9          /* --- QQ:  800003751 -------------------------------------------------*/
   10          /* Èç¹ûÒªÔÚ³ÌÐòÖÐÊ¹ÓÃ´Ë´úÂë,ÇëÔÚ³ÌÐòÖÐ×¢Ã÷Ê¹ÓÃÁËSTCµÄ×ÊÁÏ¼°³ÌÐò            */
   11          /*---------------------------------------------------------------------*/
   12          
   13          /*************  ¹¦ÄÜËµÃ÷    **************
   14          
   15          ±¾Àý³Ì»ùÓÚSTC32GÎªÖ÷¿ØÐ¾Æ¬µÄÊµÑéÏä½øÐÐ±àÐ´²âÊÔ¡£
   16          
   17          Ê¹ÓÃKeil C251±àÒëÆ÷£¬Memory ModelÍÆ¼öÉèÖÃXSmallÄ£Ê½£¬Ä¬ÈÏ¶¨Òå±äÁ¿ÔÚedata£¬µ¥Ê±ÖÓ´æÈ¡·ÃÎÊËÙ¶È¿ì¡£
   18          
   19          edata½¨Òé±£Áô1K¸ø¶ÑÕ»Ê¹ÓÃ£¬¿Õ¼ä²»¹»Ê±¿É½«´óÊý×é¡¢²»³£ÓÃ±äÁ¿¼Óxdata¹Ø¼ü×Ö¶¨Òåµ½xdata¿Õ¼ä¡£
   20          
   21          ´®¿Ú1È«Ë«¹¤ÖÐ¶Ï·½Ê½ÊÕ·¢Í¨Ñ¶³ÌÐò¡£
   22          
   23          Í¨¹ýPCÏòMCU·¢ËÍÊý¾Ý, MCUÊÕµ½ºóÍ¨¹ý´®¿Ú1°ÑÊÕµ½µÄÊý¾ÝÔ­Ñù·µ»Ø.
   24          
   25          ÓÃ¶¨Ê±Æ÷×ö²¨ÌØÂÊ·¢ÉúÆ÷£¬½¨ÒéÊ¹ÓÃ1TÄ£Ê½(³ý·ÇµÍ²¨ÌØÂÊÓÃ12T)£¬²¢Ñ¡Ôñ¿É±»²¨ÌØÂÊÕû³ýµÄÊ±ÖÓÆµÂÊ£¬ÒÔÌá¸ß¾«¶È¡£
   26          
   27          ÏÂÔØÊ±, Ñ¡ÔñÊ±ÖÓ 22.1184MHz (ÓÃ»§¿É×ÔÐÐÐÞ¸ÄÆµÂÊ).
   28          
   29          ******************************************/
   30          
   31          #include "main.h"
   32          
   33          #define UART1_BUF_LENGTH    128
   34          
   35          //==========================================================================
   36          
   37          /*************  ±¾µØ³£Á¿ÉùÃ÷    **************/
   38          
   39          
   40          /*************  IO¿Ú¶¨Òå    **************/
   41          
   42          /*************  ±¾µØ±äÁ¿ÉùÃ÷    **************/
   43          
   44          u8  TX1_Cnt;    //·¢ËÍ¼ÆÊý
   45          u8  RX1_Cnt;    //½ÓÊÕ¼ÆÊý
   46          bit B_TX1_Busy; //·¢ËÍÃ¦±êÖ¾
   47          
   48          u8  RX1_Buffer[UART1_BUF_LENGTH]; //½ÓÊÕ»º³å
   49          
   50          /*************  ±¾µØº¯ÊýÉùÃ÷    **************/
   51          
   52          /****************  Íâ²¿º¯ÊýÉùÃ÷ºÍÍâ²¿±äÁ¿ÉùÃ÷ *****************/
   53          
   54          
   55          /******************** Ö÷º¯Êý **************************/
   56          void main(void)
   57          {
   58   1          SYS_Init();
C251 COMPILER V5.60.0,  main1                                                              24/07/23  20:15:48  PAGE 2   

   59   1      
   60   1      
   61   1      
   62   1          PrintString1("STC32G UART1 Test Programme!\r\n");  //UART1·¢ËÍÒ»¸ö×Ö·û´®
   63   1      
   64   1          while (1)
   65   1          {
   66   2              if((TX1_Cnt != RX1_Cnt) && (!B_TX1_Busy))   //ÊÕµ½Êý¾Ý, ·¢ËÍ¿ÕÏÐ
   67   2              {
   68   3                  SBUF = RX1_Buffer[TX1_Cnt];
   69   3                  B_TX1_Busy = 1;
   70   3                  if(++TX1_Cnt >= UART1_BUF_LENGTH)   TX1_Cnt = 0;
   71   3              }
   72   2              PrintString1("hello\r\n");  //UART1·¢ËÍÒ»¸ö×Ö·û´®
   73   2          }
   74   1      }
   75          
   76          
   77          void SYS_Init()
   78          {
   79   1          WTST = 0;  //ÉèÖÃ³ÌÐòÖ¸ÁîÑÓÊ±²ÎÊý£¬¸³ÖµÎª0¿É½«CPUÖ´ÐÐÖ¸ÁîµÄËÙ¶ÈÉèÖÃÎª×î¿ì
   80   1          EAXFR = 1; //À©Õ¹¼Ä´æÆ÷(XFR)·ÃÎÊÊ¹ÄÜ
   81   1          CKCON = 0; //Ìá¸ß·ÃÎÊXRAMËÙ¶È
   82   1      
   83   1          P0M1 = 0x30;   P0M0 = 0x30;   //ÉèÖÃP0.4¡¢P0.5ÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   84   1          P1M1 = 0x30;   P1M0 = 0x30;   //ÉèÖÃP1.4¡¢P1.5ÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   85   1          P2M1 = 0x3c;   P2M0 = 0x3c;   //ÉèÖÃP2.2~P2.5ÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   86   1          P3M1 = 0x50;   P3M0 = 0x50;   //ÉèÖÃP3.4¡¢P3.6ÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   87   1          P4M1 = 0x3c;   P4M0 = 0x3c;   //ÉèÖÃP4.2~P4.5ÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   88   1          P5M1 = 0x0c;   P5M0 = 0x0c;   //ÉèÖÃP5.2¡¢P5.3ÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   89   1          P6M1 = 0xff;   P6M0 = 0xff;   //ÉèÖÃÎªÂ©¼«¿ªÂ·(ÊµÑéÏä¼ÓÁËÉÏÀ­µç×èµ½3.3V)
   90   1          P7M1 = 0x00;   P7M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   91   1      
   92   1          UART1_config(2);    // Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
   93   1      
   94   1          EA = 1;             //ÔÊÐíÈ«¾ÖÖÐ¶Ï
   95   1      }
   96          
   97          
   98          //========================================================================
   99          // º¯Êý: void PrintString1(u8 *puts)
  100          // ÃèÊö: ´®¿Ú1·¢ËÍ×Ö·û´®º¯Êý¡£
  101          // ²ÎÊý: puts:  ×Ö·û´®Ö¸Õë.
  102          // ·µ»Ø: none.
  103          // °æ±¾: VER1.0
  104          // ÈÕÆÚ: 2014-11-28
  105          // ±¸×¢: 
  106          //========================================================================
  107          void PrintString1(u8 *puts)
  108          {
  109   1          for (; *puts != 0;  puts++)     //Óöµ½Í£Ö¹·û0½áÊø
  110   1          {
  111   2              SBUF = *puts;
  112   2              B_TX1_Busy = 1;
  113   2              while(B_TX1_Busy);
  114   2          }
  115   1      }
  116          
  117          //========================================================================
  118          // º¯Êý: void UART1_config(u8 brt)
  119          // ÃèÊö: UART1³õÊ¼»¯º¯Êý¡£
  120          // ²ÎÊý: brt: Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
  121          // ·µ»Ø: none.
  122          // °æ±¾: VER1.0
  123          // ÈÕÆÚ: 2014-11-28
  124          // ±¸×¢: 
C251 COMPILER V5.60.0,  main1                                                              24/07/23  20:15:48  PAGE 3   

  125          //========================================================================
  126          void UART1_config()
  127          {
  128   1          S1BRT = 1;  //S1 BRT Use Timer2;
  129   1          T2R = 0;    //Timer stop
  130   1          T2_CT = 0;  //Timer2 set As Timer
  131   1          T2x12 = 1;  //Timer2 set as 1T mode
  132   1          T2H = (u8)(Baudrate1 / 256);
  133   1          T2L = (u8)(Baudrate1 % 256);
  134   1          ET2 = 0;    //½ûÖ¹ÖÐ¶Ï
  135   1          T2R = 1;    //Timer run enable
  136   1      
  137   1          SCON = (SCON & 0x3f) | 0x40;    //UART1Ä£Ê½, 0x00: Í¬²½ÒÆÎ»Êä³ö, 0x40: 8Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ, 0x80: 9Î»Ê
             -ý¾Ý,¹Ì¶¨²¨ÌØÂÊ, 0xc0: 9Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
  138   1      //  PS  = 1;    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
  139   1          ES  = 1;    //ÔÊÐíÖÐ¶Ï
  140   1          REN = 1;    //ÔÊÐí½ÓÊÕ
  141   1          P_SW1 &= 0x3f;
  142   1      //  P_SW1 |= 0x00;      //UART1 switch to, 0x00: P3.0 P3.1, 0x40: P3.6 P3.7, 0x80: P1.6 P1.7, 0xC0: P4.3 
             -P4.4
  143   1      
  144   1          B_TX1_Busy = 0;
  145   1          TX1_Cnt = 0;
  146   1          RX1_Cnt = 0;
  147   1      }
  148          
  149          
  150          //========================================================================
  151          // º¯Êý: void UART1_int (void) interrupt UART1_VECTOR
  152          // ÃèÊö: UART1ÖÐ¶Ïº¯Êý¡£
  153          // ²ÎÊý: nine.
  154          // ·µ»Ø: none.
  155          // °æ±¾: VER1.0
  156          // ÈÕÆÚ: 2014-11-28
  157          // ±¸×¢: 
  158          //========================================================================
  159          void UART1_int (void) interrupt 4
  160          {
  161   1          if(RI)
  162   1          {
  163   2              RI = 0;
  164   2              RX1_Buffer[RX1_Cnt] = SBUF;
  165   2              if(++RX1_Cnt >= UART1_BUF_LENGTH)   RX1_Cnt = 0;
  166   2          }
  167   1      
  168   1          if(TI)
  169   1          {
  170   2              TI = 0;
  171   2              B_TX1_Busy = 0;
  172   2          }
  173   1      }
  174          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       258     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       130     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
C251 COMPILER V5.60.0,  main1                                                              24/07/23  20:15:48  PAGE 4   

  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        39     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
